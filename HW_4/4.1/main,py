import time
from threading import Thread
import multiprocessing as mp


def fib(n: int) -> int:
    if n < 2:
        return n
    return fib(n - 1) + fib(n - 2)


def thread_fib(n: int, idx: int, results: list[int]) -> None:
    results[idx] = fib(n)


def process_fib(n: int) -> None:
    fib(n)


def thread_run(n: int, tasks: int) -> float:
    results = [0] * tasks
    threads: list[Thread] = []

    t0 = time.perf_counter()
    for i in range(tasks):
        th = Thread(target=thread_fib, args=(n, i, results))
        th.start()
        threads.append(th)

    for th in threads:
        th.join()
    t1 = time.perf_counter()

    return t1 - t0


def process_run(n: int, tasks: int) -> float:
    procs: list[mp.Process] = []

    t0 = time.perf_counter()
    for _ in range(tasks):
        p = mp.Process(target=process_fib, args=(n,))
        p.start()
        procs.append(p)

    for p in procs:
        p.join()
    t1 = time.perf_counter()

    return t1 - t0


def main() -> int:
    thread_res = thread_run(35, 10)
    process_res = process_run(35, 10)
    print(f'Время выполнения threading: {round(thread_res, 3)}')
    print(f'Время выполнения multiprocessing: {round(process_res, 3)}')

    with open("results.txt", "w", encoding="utf-8") as f:
        f.write(f'Время выполнения threading: {round(thread_res, 3)}' + "\n")
        f.write(f'Время выполнения multiprocessing: {round(process_res, 3)}' + "\n")


if __name__ == "__main__":
    main()
